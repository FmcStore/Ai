<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fmc AI - Quily Model</title> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* --- Reset & Base --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        :root { --primary-color: #2563eb; --primary-hover: #1d4ed8; --bg-color: #ffffff; --chat-bg: #ffffff; --sidebar-bg: #f9fafb; --border-color: #e5e7eb; --text-primary: #111827; --text-secondary: #6b7280; --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05); --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        body { background-color: var(--bg-color); color: var(--text-primary); height: 100vh; width: 100vw; display: flex; flex-direction: column; font-size: 16px; overflow: hidden; }
        .header { background: rgba(255, 255, 255, 0.95); padding: 0 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; height: 64px; flex-shrink: 0; z-index: 50; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .header-logo-img { width: 36px; height: 36px; border-radius: 10px; object-fit: cover; }
        .logo h1 { font-size: 18px; font-weight: 700; color: #111; letter-spacing: -0.02em; }
        .model-tag { background: #eff6ff; color: var(--primary-color); padding: 6px 14px; border-radius: 100px; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .main-container { display: flex; flex: 1; overflow: hidden; position: relative; width: 100%; }
        .sidebar { width: 280px; background-color: var(--sidebar-bg); padding: 24px; display: flex; flex-direction: column; gap: 24px; border-right: 1px solid var(--border-color); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 100; }
        .new-chat-btn { background: #fff; color: var(--text-primary); border: 1px solid var(--border-color); padding: 14px; border-radius: 12px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 12px; box-shadow: var(--shadow-sm); transition: all 0.2s; }
        .new-chat-btn:hover { border-color: var(--primary-color); color: var(--primary-color); box-shadow: var(--shadow-md); }
        .history-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }
        .history-item { padding: 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 14px; color: #4b5563; transition: 0.2s; }
        .history-item:hover { background: #e5e7eb; color: #111; }
        .chat-container { flex: 1; display: flex; flex-direction: column; background-color: var(--chat-bg); position: relative; width: 100%; }
        .chat-messages { flex: 1; padding: 24px 0; overflow-y: auto; display: flex; flex-direction: column; gap: 32px; width: 100%; scroll-behavior: smooth; }
        .message { display: flex; gap: 16px; max-width: 800px; margin: 0 auto; width: 100%; padding: 0 24px; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message-avatar { width: 38px; height: 38px; border-radius: 10px; flex-shrink: 0; background-size: cover; background-position: center; }
        .user .message-avatar { background-image: url('https://files.catbox.moe/gpw6ah.png'); box-shadow: var(--shadow-sm); }
        .bot .message-avatar { background-image: url('https://files.catbox.moe/yfxidj.png'); border: 1px solid #f3f4f6; }
        .message-content { flex: 1; min-width: 0; line-height: 1.7; font-size: 16px; }
        .user { flex-direction: row-reverse; }
        .user .message-content { display: flex; justify-content: flex-end; }
        .user .message-content p { background: var(--primary-color); color: white; padding: 12px 18px; border-radius: 18px 18px 4px 18px; box-shadow: var(--shadow-sm); display: inline-block; text-align: left; max-width: 100%; }
        .bot .message-content { color: #374151; padding-top: 6px; }
        .bot strong { color: #000; font-weight: 600; }
        .code-block { background: #1e293b; color: #e2e8f0; border-radius: 12px; margin: 16px 0; overflow: hidden; font-family: 'JetBrains Mono', monospace; font-size: 14px; box-shadow: var(--shadow-md); }
        .code-block pre { padding: 16px; overflow-x: auto; }
        code { background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.9em; color: #d63384; }
        .input-container { padding: 24px; background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 20%); width: 100%; flex-shrink: 0; position: relative; }
        .input-box-wrapper { max-width: 800px; width: 100%; margin: 0 auto; background: #fff; border: 1px solid #e5e7eb; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.08); display: flex; flex-direction: column; overflow: hidden; transition: all 0.2s; }
        .input-box-wrapper:focus-within { border-color: var(--primary-color); box-shadow: 0 10px 30px -5px rgba(37, 99, 235, 0.15); transform: translateY(-2px); }
        .input-tools { display: flex; justify-content: space-between; align-items: center; padding: 8px 20px; background-color: #fafafa; border-bottom: 1px solid #f3f4f6; }
        .textarea-container { display: flex; align-items: flex-end; padding: 10px 16px; background: #fff; }
        .input-box-wrapper textarea { flex: 1; padding: 8px; border: none; background: transparent; resize: none; font-size: 16px; max-height: 200px; outline: none; color: var(--text-primary); line-height: 1.5; }
        .send-btn { background: var(--primary-color); color: white; border: none; width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; margin-left: 10px; margin-bottom: 2px; flex-shrink: 0; transition: 0.2s; }
        .send-btn:hover { background: var(--primary-hover); }
        .send-btn:disabled { background: #cbd5e1; cursor: not-allowed; }
        .search-toggle-container { display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; user-select: none; }
        .search-toggle-container.active { color: var(--primary-color); }
        .switch { position: relative; display: inline-block; width: 36px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #e5e7eb; transition: .3s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .3s; border-radius: 50%; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(16px); }
        .welcome-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 60px 20px; opacity: 0; animation: fadeIn 0.8s forwards; }
        .welcome-icon { font-size: 64px; color: var(--primary-color); margin-bottom: 24px; background: #eff6ff; padding: 20px; border-radius: 24px; }
        .welcome-screen h2 { font-size: 24px; font-weight: 700; margin-bottom: 8px; color: #111; }
        .suggestions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; width: 100%; max-width: 700px; margin-top: 40px; }
        .suggestion-card { padding: 20px; background: #fff; border: 1px solid var(--border-color); border-radius: 16px; cursor: pointer; text-align: left; font-size: 14px; transition: all 0.2s; box-shadow: var(--shadow-sm); }
        .suggestion-card:hover { border-color: var(--primary-color); transform: translateY(-3px); box-shadow: var(--shadow-md); }
        .suggestion-title { font-weight: 600; margin-bottom: 6px; display:block; color: var(--primary-color); }
        @media (max-width: 768px) { .sidebar { position: fixed; left: -100%; top: 0; height: 100%; box-shadow: 20px 0 50px rgba(0,0,0,0.1); } .sidebar.active { left: 0; } #mobile-menu { display: block !important; } .message { padding: 0 16px; gap: 10px; } .input-container { padding: 16px; } .suggestions { grid-template-columns: 1fr; } }
        .typing-dots { display: flex; gap: 6px; padding: 10px 0; }
        .dot { width: 8px; height: 8px; background: #94a3b8; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; } .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <button id="mobile-menu" style="background:none; border:none; cursor:pointer; display:none; padding:4px;">
                <span class="material-icons" style="color:#374151">menu</span>
            </button>
            <img src="https://files.catbox.moe/yfxidj.png" class="header-logo-img" alt="logo">
            <h1>Fmc Chat</h1>
        </div>
        <div class="model-tag">
            <span class="material-icons" style="font-size: 16px;">auto_awesome</span>
            <span>Quily AI</span>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar" id="sidebar">
            <button class="new-chat-btn" id="new-chat-btn">
                <span class="material-icons" style="color: var(--primary-color)">add_circle</span> New Chat
            </button>
            <div class="history-label">Riwayat Chat</div>
            <div id="history-list" style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:8px;"></div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <div class="welcome-screen" id="welcome-screen">
                    <div class="welcome-icon"><span class="material-icons" style="font-size: inherit;">smart_toy</span></div>
                    <h2>Halo, ada yang bisa saya bantu?</h2>
                    <div class="suggestions">
                        <div class="suggestion-card" onclick="setInput('Jelaskan apa itu Black Hole secara sederhana')"><span class="suggestion-title">üî¨ Sains</span>Apa itu Black Hole?</div>
                        <div class="suggestion-card" onclick="setInput('Buatkan puisi pendek tentang hujan')"><span class="suggestion-title">üé® Kreatif</span>Puisi tentang hujan</div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <div class="input-box-wrapper">
                    <div class="input-tools">
                        <div class="search-toggle-container" id="search-toggle-wrapper">
                            <label class="switch"><input type="checkbox" id="web-search-toggle"><span class="slider"></span></label>
                            <span id="search-label" style="margin-left:8px;">Web Search: <b>OFF</b></span>
                        </div>
                    </div>
                    <div class="textarea-container">
                        <textarea id="message-input" placeholder="Ketik pesan Anda di sini..." rows="1"></textarea>
                        <button class="send-btn" id="send-btn"><span class="material-icons">arrow_upward</span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const welcomeScreen = document.getElementById('welcome-screen');
        const webSearchToggle = document.getElementById('web-search-toggle');

        let currentChatId = null;
        let isProcessing = false;

        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        webSearchToggle.addEventListener('change', function() {
            const label = document.getElementById('search-label');
            label.innerHTML = this.checked ? "Web Search: <b style='color:#2563eb'>ON</b>" : "Web Search: <b>OFF</b>";
        });

        sendBtn.addEventListener('click', handleSend);
        messageInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } });

        function setInput(text) { messageInput.value = text; messageInput.focus(); messageInput.dispatchEvent(new Event('input')); }

        async function handleSend() {
            const text = messageInput.value.trim();
            if (!text || isProcessing) return;
            welcomeScreen.style.display = 'none';
            addMessage(text, 'user');
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            setLoading(true);
            try {
                // Memanggil backend internal Vercel
                const response = await fetch(`/api/chat?query=${encodeURIComponent(text)}&webSearch=${webSearchToggle.checked}&chatId=${currentChatId || ''}`);
                const data = await response.json();
                setLoading(false);
                if (data.status && data.result) {
                    if (data.result.chatId) currentChatId = data.result.chatId;
                    addMessage(data.result.answer, 'bot', data.result.webSearch);
                } else {
                    addMessage("Terjadi kesalahan sistem.", 'bot');
                }
            } catch (e) {
                setLoading(false);
                addMessage("Koneksi gagal.", 'bot');
            }
        }

        function addMessage(text, sender, isSearch = false) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            const avatar = document.createElement('div'); avatar.className = 'message-avatar';
            const content = document.createElement('div'); content.className = 'message-content';
            if (sender === 'user') {
                content.innerHTML = `<p>${text.replace(/&/g, "&amp;").replace(/</g, "&lt;")}</p>`;
            } else {
                let html = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
                if (isSearch) html = `<div style="font-size:12px; color:#2563eb; margin-bottom:8px;">üîç Pencarian Web</div>` + html;
                content.innerHTML = html;
            }
            div.appendChild(avatar); div.appendChild(content);
            chatMessages.appendChild(div);
            chatMessages.scrollTo({ top: chatMessages.scrollHeight, behavior: 'smooth' });
        }

        function setLoading(state) {
            isProcessing = state; sendBtn.disabled = state;
            if (state) {
                const loader = document.createElement('div'); loader.id = 'loader'; loader.className = 'message bot';
                loader.innerHTML = `<div class="message-avatar"></div><div class="message-content"><div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;
                chatMessages.appendChild(loader);
            } else {
                const loader = document.getElementById('loader'); if(loader) loader.remove();
            }
        }
    </script>
</body>
</html>
